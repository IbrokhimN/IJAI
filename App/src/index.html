<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Local Monitor — Nexus Insights</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
  :root{
    --p:#4285F4; --g:#34A853; --bg:#F6F7FB; --card:#fff; --muted:#5F6368;
    --shadow:0 6px 18px rgba(18,38,63,0.08); --radius:12px;
    --gap:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
  .app{display:flex;min-height:100vh;gap:var(--gap)}
  /* sidebar */
  .sidebar{width:240px;background:var(--card);padding:20px;border-right:1px solid rgba(0,0,0,0.04);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--p)}
  .small{font-size:13px;color:var(--muted)}
  .nav{margin-top:8px;display:flex;flex-direction:column;gap:6px}
  .nav button{background:transparent;border:0;padding:10px;border-radius:8px;text-align:left;cursor:pointer;color:var(--muted)}
  .nav button.active{background:rgba(66,133,244,0.08);color:var(--p)}
  .sidebar .footer{margin-top:auto;font-size:13px;color:var(--muted)}
  /* main */
  .main{flex:1;padding:20px;display:flex;flex-direction:column;gap:16px}
  .top{display:flex;justify-content:space-between;gap:16px;align-items:center}
  .cards{display:flex;gap:12px;flex-wrap:wrap}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);min-width:180px;flex:1;max-width:320px}
  .card .label{font-size:13px;color:var(--muted)}
  .card .value{font-size:20px;font-weight:700;margin-top:6px}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:var(--p);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--p);border:1px solid rgba(66,133,244,0.12)}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px;align-items:start}
  .panel{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
  .panel h3{margin:0 0 10px 0;font-size:16px}
  /* history table */
  .searchline{display:flex;gap:8px;margin-bottom:8px}
  input[type="search"], select{padding:8px;border-radius:8px;border:1px solid #e6e9ef;flex:1}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:8px;text-align:left;border-bottom:1px solid #f1f3f6;color:#222}
  tr.small td{font-size:12px;color:var(--muted)}
  .muted{color:var(--muted)}
  /* charts */
  canvas{width:100%;height:180px;display:block}
  .stat-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .chip{background:#f3f6ff;padding:6px 8px;border-radius:999px;font-size:13px;color:var(--p)}
  /* responsive */
  @media (max-width:900px){
    .app{flex-direction:column}
    .sidebar{width:100%;flex-direction:row;align-items:center;overflow:auto}
    .main{padding:12px}
    .grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar" aria-label="sidebar">
    <div class="brand"><i class="material-icons" style="font-size:20px">memory</i>Nexus Insights</div>
    <div class="small">Local AI monitor — shows how the model interacts with your PC</div>
    <nav class="nav" id="nav">
      <button class="active" data-page="overview">Overview</button>
      <button data-page="history">Requests</button>
      <button data-page="resources">Resources</button>
      <button data-page="privacy">Privacy</button>
      <button data-page="settings">Settings</button>
    </nav>
    <div class="footer">Version <strong>0.9</strong> · Local demo</div>
  </aside>

  <main class="main">
    <div class="top">
      <div>
        <h2 style="margin:0">AI on this PC — Live</h2>
        <div class="small">Realtime overview of usage, requests and past activity</div>
      </div>
      <div class="controls">
        <div class="stat-row">
          <div class="chip" id="uptimeChip">Uptime: 0h</div>
          <div class="chip" id="reqChip">Requests: 0</div>
        </div>
        <button class="btn" id="exportCsv">Export CSV</button>
        <button class="btn ghost" id="simulate">Simulate +</button>
      </div>
    </div>

    <!-- quick cards -->
    <div class="cards">
      <div class="card">
        <div class="label">Active model</div>
        <div class="value" id="modelName">gpt-local-1</div>
        <div class="small">Version <span id="modelVer">v1.2.0</span> · <span id="device">CPU</span></div>
      </div>
      <div class="card">
        <div class="label">Total requests</div>
        <div class="value" id="totalReq">0</div>
        <div class="small">Avg latency: <span id="avgLatency">—</span> ms</div>
      </div>
      <div class="card">
        <div class="label">Active sessions</div>
        <div class="value" id="sessions">0</div>
        <div class="small">Unique users/devices: <span id="uniqueClients">0</span></div>
      </div>
    </div>

    <div class="grid">
      <!-- left: charts + history -->
      <div>
        <div class="panel">
          <h3>Requests — last 60 minutes</h3>
          <canvas id="reqChart"></canvas>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <div class="small">Shows per-minute requests</div>
            <div class="small">Peak: <strong id="peak">0</strong>/min</div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h3>Recent queries</h3>
          <div class="searchline">
            <input type="search" id="qSearch" placeholder="Search queries or filter by user..." />
            <select id="filterModel"><option value="">All models</option><option>gpt-local-1</option><option>gpt-2mini</option></select>
            <button class="btn ghost" id="anonToggle">Anonymize: OFF</button>
          </div>
          <div style="max-height:260px;overflow:auto">
            <table id="historyTable" aria-live="polite">
              <thead><tr><th>Time</th><th>Client</th><th>Prompt / Query</th><th>Latency ms</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- right: resources + features -->
      <div>
        <div class="panel">
          <h3>System resources</h3>
          <div style="display:flex;gap:10px;align-items:center">
            <div style="flex:1">
              <div class="small">CPU usage</div>
              <canvas id="cpuChart" style="height:80px"></canvas>
            </div>
            <div style="flex:1">
              <div class="small">Memory usage</div>
              <canvas id="memChart" style="height:80px"></canvas>
            </div>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <div class="small">Model load: <strong id="modelLoad">12%</strong></div>
            <div class="small">Disk cache: <strong id="diskCache">1.6GB</strong></div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h3>Useful actions</h3>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn" id="clearHistory">Clear History</button>
            <button class="btn ghost" id="resetStats">Reset Stats</button>
            <label class="small"><input type="checkbox" id="persistToggle"> Persist logs to disk (demo)</label>
            <div class="small muted">Tip: Connect real metrics via a small agent that posts JSON to this page.</div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
/* ---------------------------
  Simple local monitor simulation
  Replace simulated parts with real metrics easily:
  - push new events into `addRequest({client, prompt, latency, model})`
  - update system metrics via updateSystem({...})
----------------------------*/

const state = {
  uptimeMin: 0,
  requests: [],
  totals: {count:0, latencySum:0},
  perMinute: new Array(60).fill(0),
  cpuSamples: [],
  memSamples: [],
  anon:false
};

const $ = id => document.getElementById(id);
const tbody = document.querySelector('#historyTable tbody');
const uptimeChip = $('uptimeChip'), reqChip = $('reqChip');
const totalReq = $('totalReq'), avgLatency = $('avgLatency'), sessions = $('sessions'), uniqueClients = $('uniqueClients');
const peakEl = $('peak'), modelName = $('modelName'), modelVer = $('modelVer'), deviceEl = $('device');
const modelLoad = $('modelLoad'), diskCache = $('diskCache');
const anonToggle = $('anonToggle');

// helpers
function formatTime(d){ const t = new Date(d); return t.toLocaleTimeString();}
function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

/* Add request event */
function addRequest({client='local', prompt='(empty)', latency=120, model='gpt-local-1', ts=Date.now()}){
  state.requests.unshift({client,prompt,latency,model,ts});
  if(state.requests.length>500) state.requests.pop();
  state.totals.count += 1;
  state.totals.latencySum += latency;
  // per-minute slot
  const now = Math.floor(Date.now()/60000)%60;
  state.perMinute[now] = (state.perMinute[now]||0)+1;
  // sessions & clients
  render();
}

/* Update resource samples */
function sampleResources(){
  // simulated CPU/MEM usage
  const cpu = clamp(10 + Math.round(Math.random()*60 + (state.totals.count%10)), 3, 98);
  const mem = clamp(20 + Math.round(Math.random()*60), 10, 98);
  state.cpuSamples.push(cpu); if(state.cpuSamples.length>60) state.cpuSamples.shift();
  state.memSamples.push(mem); if(state.memSamples.length>60) state.memSamples.shift();
  modelLoad.textContent = `${clamp(Math.round(cpu/6),3,99)}%`;
  diskCache.textContent = `${(1.5 + (state.totals.count%40)*0.02).toFixed(2)}GB`;
}

/* UI render */
function render(){
  uptimeChip.textContent = `Uptime: ${Math.floor(state.uptimeMin/60)}h ${state.uptimeMin%60}m`;
  reqChip.textContent = `Requests: ${state.totals.count}`;
  totalReq.textContent = state.totals.count;
  avgLatency.textContent = state.totals.count ? Math.round(state.totals.latencySum/state.totals.count) : '—';
  sessions.textContent = new Set(state.requests.map(r=>r.client)).size;
  uniqueClients.textContent = new Set(state.requests.map(r=>r.client)).size;
  peakEl.textContent = Math.max(...state.perMinute);

  // history table (first 50)
  const search = document.getElementById('qSearch').value.toLowerCase();
  const modelFilter = document.getElementById('filterModel').value;
  tbody.innerHTML = '';
  for(const r of state.requests.slice(0,200)){
    if(modelFilter && r.model!==modelFilter) continue;
    if(search && !(r.prompt.toLowerCase().includes(search) || r.client.toLowerCase().includes(search))) continue;
    const tr = document.createElement('tr');
    const client = state.anon ? anonymizeClient(r.client) : r.client;
    tr.innerHTML = `<td class="small">${formatTime(r.ts)}</td>
                    <td>${client}</td>
                    <td style="max-width:340px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escapeHtml(r.prompt)}</td>
                    <td class="small">${r.latency}</td>`;
    tbody.appendChild(tr);
  }
  // draw charts
  drawReqChart();
  drawMiniChart('cpuChart', state.cpuSamples, {max:100});
  drawMiniChart('memChart', state.memSamples, {max:100, color:'#34A853'});
}

/* small util */
function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c])}
function anonymizeClient(name){ return name.replace(/(.).+/, '$1***'); }

/* draw requests chart on canvas */
function drawReqChart(){
  const canvas = document.getElementById('reqChart');
  const ctx = canvas.getContext('2d');
  // ensure pixel ratio
  const w = canvas.clientWidth, h = 180;
  canvas.width = w * devicePixelRatio; canvas.height = h * devicePixelRatio;
  ctx.scale(devicePixelRatio, devicePixelRatio);
  ctx.clearRect(0,0,w,h);

  const data = [];
  // convert perMinute to ordered last 60
  const nowIdx = Math.floor(Date.now()/60000)%60;
  for(let i=0;i<60;i++){
    const idx = (nowIdx + 1 + i) % 60;
    data.push(state.perMinute[idx] || 0);
  }
  const max = Math.max(5, ...data);
  // background grid
  ctx.fillStyle = '#fff'; ctx.fillRect(0,0,w,h);
  ctx.strokeStyle = '#eef2f6'; ctx.lineWidth = 1;
  for(let i=0;i<=4;i++){
    const y = (h/4)*i; ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke();
  }

  // area gradient
  const grad = ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0, 'rgba(66,133,244,0.18)');
  grad.addColorStop(1, 'rgba(66,133,244,0.02)');
  // path
  ctx.beginPath();
  data.forEach((v,i)=>{
    const x = (w/59)*i;
    const y = h - (v/max) * (h-20);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.lineTo(w,h); ctx.lineTo(0,h); ctx.closePath();
  ctx.fillStyle = grad; ctx.fill();

  // stroke line
  ctx.beginPath();
  ctx.moveTo(0, h - (data[0]/max)*(h-20));
  data.forEach((v,i)=> ctx.lineTo((w/59)*i, h - (v/max)*(h-20)));
  ctx.strokeStyle = '#2B6CE6'; ctx.lineWidth = 2.2; ctx.stroke();
}

/* draw tiny sparkline */
function drawMiniChart(id, arr, opts={}){
  const canvas = document.getElementById(id);
  const ctx = canvas.getContext('2d');
  const w = canvas.clientWidth, h = canvas.clientHeight;
  canvas.width = w*devicePixelRatio; canvas.height = h*devicePixelRatio;
  ctx.scale(devicePixelRatio, devicePixelRatio);
  ctx.clearRect(0,0,w,h);
  const data = arr.slice(-60);
  if(data.length===0) return;
  const max = opts.max || Math.max(...data);
  ctx.beginPath();
  data.forEach((v,i)=>{
    const x = (w/(data.length-1))*i;
    const y = h - (v/max)*(h-8) - 4;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.strokeStyle = opts.color || '#2B6CE6'; ctx.lineWidth = 2; ctx.stroke();
}

/* ticking */
setInterval(()=>{
  state.uptimeMin++;
  sampleResources();
  // decay perMinute (every minute should be rotated by minute tick) -> handled by using index
  // simulated small background traffic occasionally
  if(Math.random() < 0.3) {
    const clients = ['local','appA','user-12','service-B','devbox'];
    addRequest({client:clients[Math.floor(Math.random()*clients.length)],
                prompt:['Summarize log','Translate text','Write SQL','Explain error','Generate email'][Math.floor(Math.random()*5)],
                latency: Math.round(50 + Math.random()*300),
                model: Math.random()<0.8 ? 'gpt-local-1' : 'gpt-2mini'});
  }
  render();
}, 60000); // every minute

/* demo simulate button adds burst */
document.getElementById('simulate').addEventListener('click', ()=>{
  for(let i=0;i<6;i++){
    addRequest({
      client: `user-${Math.floor(Math.random()*60)}`,
      prompt: ['What is AI?','Optimize this code','Write a poem','How to cook rice?','Explain regex'][Math.floor(Math.random()*5)],
      latency: Math.round(40 + Math.random()*400),
      model: Math.random()<0.7 ? 'gpt-local-1' : 'gpt-2mini',
      ts: Date.now() - Math.floor(Math.random()*60000)
    });
  }
  // add CPU/mem burst
  state.cpuSamples.push(clamp(40 + Math.round(Math.random()*40),5,99));
  state.memSamples.push(clamp(40 + Math.round(Math.random()*40),10,99));
  render();
});

/* export CSV */
document.getElementById('exportCsv').addEventListener('click', ()=>{
  const rows = [['time','client','model','prompt','latency_ms']];
  for(const r of state.requests){
    rows.push([new Date(r.ts).toISOString(), r.client, r.model, r.prompt.replace(/\n/g,' '), r.latency]);
  }
  const csv = rows.map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'ai_local_requests.csv'; a.click(); URL.revokeObjectURL(url);
});

/* clear/reset */
document.getElementById('clearHistory').addEventListener('click', ()=>{ state.requests=[]; render();});
document.getElementById('resetStats').addEventListener('click', ()=>{ state.totals={count:0,latencySum:0}; state.perMinute = new Array(60).fill(0); state.cpuSamples=[]; state.memSamples=[]; render();});

/* search/filter/anon */
document.getElementById('qSearch').addEventListener('input', render);
document.getElementById('filterModel').addEventListener('change', render);
anonToggle.addEventListener('click', ()=>{
  state.anon = !state.anon;
  anonToggle.textContent = `Anonymize: ${state.anon ? 'ON' : 'OFF'}`;
  anonToggle.classList.toggle('active', state.anon);
  render();
});

/* nav pages (simple show/hide) */
document.querySelectorAll('#nav button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('#nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    // for demo: only switch visual hint — could implement full routing
    const page = btn.dataset.page;
    // we highlight different panels depending on page
    if(page==='history') document.querySelector('#qSearch').focus();
  });
});

/* seed initial demo data */
(function seed(){
  modelName.textContent = 'gpt-local-1';
  modelVer.textContent = 'v1.2.0';
  deviceEl.textContent = 'CPU';
  for(let i=0;i<120;i++){
    const clients = ['local','appA','user-12','service-B','devbox'];
    addRequest({client:clients[Math.floor(Math.random()*clients.length)],
                prompt:['Summarize log','Translate text','Write SQL','Explain error','Generate email'][Math.floor(Math.random()*5)],
                latency: Math.round(40 + Math.random()*400),
                model: Math.random()<0.85 ? 'gpt-local-1' : 'gpt-2mini',
                ts: Date.now() - Math.floor(Math.random()*1000*60*120)
              });
  }
  // populate samples
  for(let i=0;i<30;i++){ sampleResources(); state.uptimeMin += 10; }
  render();
})();
</script>
</body>
</html>
